# SMX-MINI_FRANKYSND

Gosta do que faço e gostaria de me pagar um café como agradecimento? 
https://ko-fi.com/R6R2BRGX6
Só o faça se sentir vontade :)

IMPORTANTE! LEIA TUDO E SEJA CUIDADOSO! NÃO É DIVERTIDO BRICAR SEU MSX FPGA!
NÃO É TÃO SIMPLES RESTAURAR ELE USANDO JIC / USB BLASTER JÁ QUE IRÁ PRECISAR DO
USB BLASTER, INSTALAR O QUARTUS PARA USAR O PROGRAMMER, E NO CASO DO SMX-HB A
PORTA JTAG NÃO É ACESSÍVEL COM O MÓDULO FPGA NA PLACA, PRECISANDO RETIRAR O
MESMO DA PLACA E CONECTAR A UMA FONTE EXTERNA. VOCÊ FOI AVISADO! AVISADO MESMO!

APENAS USE O SMXFLASH.COM para atualizar seu FPGA MSX de segunda geração (SM-X,
SMX-HB, SM-X Mini, SX2). NÃO USE O SMXFLASH NO MULTICORE 2+! No caso do MC2+
o arquivo MCP substitui o MCP anterior e isso é tudo que é necessário. APENAS
USE UM FIRMWARE QUE É PARA O SEU DISPOSITIVO. CADA DISPOSITIVO UTILIZA CONEXÕES
DIFRENTES, ALGUNS USAM FPGAs DIFERENTES, ENTÃO NUNCA SEQUER PENSE EM USAR O PLD
DOS DISPOSITIVOS DE PRIMEIRA GERAÇÃO TAMPOUCO EM UTILIZAR UM PLD DE DISPOSITIVO
DE SEGUNDA GERAÇÃO QUE NÃO TENHA O NOME DO SEU DISPOSITIVO NO ARQUIVO ZIP.

A versão do SMXFLASH.COM disponível junto aos firmwares no pacote
flashandconfigtools.zip também funciona com o NEXTOR. Versões anteriores do
SMXFLASH.COM dependem do Kernel do MSX DOS 2 para funcionar. Qual a razão para
usar outra versão? Não tenho idéia. Leia o documento inteiro e seja cuidadoso
para não ter problemas. No MSX DOS / Nextor, use a seguinte linha de comando
para atualizar (exceto MC2+, MC2+ apenas substitua o arquivo de core com a 
extensão .MCP pelo novo arquivo do pacote):

SMXFLASH OCM_SM.PLD

Aguarde até que o SMXFLASH retorne ao prompt do DOS dizendo que terminou. Caso
haja uma mensagem de erro após ter iniciado a apagar ou escrever, tente
novamente até que funcione, pois se desligar o dispositivo com um update não
terminado, seu dispositivo irá BRICAR e precisará de um USB Blaster e o arquivo
JIC para restaurar o mesmo, processo que é um pé...

Também, fique ciente que se houver queda de energia durante a atualização, é
bem provável que seu dispositivo irá BRICAR e precisará utilizar o USB Blaster
e arquivo JIC para restaurar o mesmo...

Novidades em relação a v3.9b

    - Melhorias e correções na emulação de mouse MSX usando mouse PS/2
    - Como resultado, a emulação do paddle ficou mais suave

Notas de liberação da versão

OCM-PLD v3.9c é uma extensão da OCM v3.9 do KdL. O que essa versão tem de
diferente:

- OPL3:

    - Correção: Arrumei a OPL3, tinha dois problemas que faziam OPL3 não
      funcionar com a última versão do VGMPlay:

        - IRQ estava desconectado, então os temporizadores programados não
          geravam interrupção, e com apenas a interrupção do VDP, a música 
          tocava muito devagar.

        - Mesmo com IRQ conectado, a velocidade melhorou mas estava lenta. O
          temporizador tem uma escala que estava com valor incorreto para o
          clock utilizado, causando os temporizadores demorarem mais que o
          programado para acionar a interrupção.

      O VGMPlay 1.3 depende dos temporizadores da OPL3 quando a mesma está
      presente, como um temporizador de alta resolução, e não ter o IRQ ligado
      e não ter a escala correta nos temporizadores causava o mal funcionamento
      do mesmo...

    - Correção para dispositivos segunda geração: originalmente a OPL3 estava
      apenas com um canal conectado, descartando qualquer som tocando apenas no
      canal desconectado. Imagino que a razão disso é que ao conectar e mixar
      ambos canais, o uso de recursos FPGA vão além do que os FPGA de segunda
      geração tem disponível (o sequenciador de cada canal usa vários registros
      e ao ter um canal conectado apenas, o Quartus simplesmente corta esses
      registradores já que a saída não é conectada a nada). Fiz um pequeno
      truque para resolver essa situação, permitindo que todo o conteúdo seja
      tocado em apenas um canal sem ter que renderizar ambos e mixar depois. :P
      Tente por exemplo a terceira música da trilha sonora do Doom antes e
      depois da correção para sentir a diferença. :)

- SN76489 e 2xPSG:

    - Novidade: suporte parcial a uma "Franky" embutida. Esse suporte parcial
      é suficiente para que SG1000, COL4MMM (usando as versões COM\Franky),
      VGMPLAY, ROBOPLAY e Sofarun (lembre de configurar de forma que use o VDP
      do MSX e PSG do Franky para SMS/SG1000). Como a Franky utiliza as portas
      0x48 e 0x49 que fazem parte das portas reservadas para I/O chaveado, irá
      estar desabilitado inicialmente, já que o módulo que carrega a BIOS MSX
      deixa o dispositivo de I/O chaveado selecionado após o boot. Há várias
      opções para habilitar o som da Franky:

        - A última versão do COL4MMM automaticamente desabilita o I/O chaveado,
        então não é necessário nada para que funcione. :)re.

        - VGMPLAY também desabilita automaticante o I/O chaveado, então se usar
        o VGMPLAY e tocar uma música que usa o SN76489, após sair do VGMPLAY
        poderá utilizar qualquer outro software que o som irá funcionar.

        - Enviar pelo BASIC o comando OUT &H40,0 que desabilita o I/O chaveado.

        - Usar SETSMART -8C para reservar as portas 0x48 e 0x49 para o Franky,
        ao fazer isso qualquer programa que dependa dessas portas para ler
        informações do OCM não irá obter a informação correta.

    - Novidade: Segundo PSG nas porta 0x10-0x13. Também permite que os
      regsitradores do segundo PSG sejam lidos.

- Para todos dispositivos / firmwares:

    - Melhoria: Victor Trucco fez melhorias no controlador de SDRAM que agora é
      capaz de trabalhar com diferentes chips. Alguns SM-X mini e SMX-HB usam
      chips que precisam dessa melhoria pra funcionar.

    - Novidade: Emulação de Paddle usando um mouse PS/2. Para habilitar o modo
      VAUS (Arkanoid/Taito) use SETSMART -8E, to habilitar o modo MSX use
      SETSMART -8F, para desabilitar (padrão) use SETSMART -8D. Note que um
      paddle MSX apenas funciona corretamente se o Z80 estiver a 3.58MHz, como
      um veradeiro paddle MSX em um MSX com CPU turbo.

    - Correção: Não era possível mover apenas um ponto no eixo X. Também
      adicionei quatro níveis de sensibilidade que podem ser alternados com o
      clique do terceiro botão do mouse (se seu mouse não for compatível com o
      padrão intellimouse / três botões, a sensibilidade estará fixa próximo ao
      que era originalmente).

    - Correção: a emulação de Mouse MSX não funcionava muito bem se um controle
      SEGA de quatro ou oito botões estivesse conectado com um Joymega. Agora o
      mouse é detectado adequadamente, porém, o controle só retoma o uso da
      porta de Joystick se apertar os botões A, B, C ou START (ou 1 e 2 em 
      controles de 2 botões).

    - Correção: ao mudar de controle para mouse e vice versa, agora a porta de
      controles é "desconectada" por 1 segundo. Em um MSX real não é possível
      mudar de controle para mouse (e vice versa) sem desconectar o mesmo da
      porta, HIDTEST e jogos/programas que usem a HIDLIB dependem desse evento
      de desconexão e posterior conexão para detectar a troca de dispositivo.

    - Melhoria: a emulação de mouse MSX do MC2+ foi portada para todos. É uma
      forma melhor que contam com time-out para retornar sozinho ao primeiro
      estado após algum tempo sem leitura, assim como um mouse MSX real.

Todo código fonte e binários alterados em relação ao OCM 3.9:
(c)2022 Oduvaldo Pavan Junior - ducasp@gmail.com

Todo código fonte do OCM 3.9 é um trabalho de muitas pessoas, incluindo KdL e
Hara-san que são grandes contribuidores!

Todo código adcional pode ser reutilizado, re-escrito, trabalhos derivados
podem ser vendidos DESDE QUE o código fonte das mudanças seja publicado também.
Para o código original do OCM 3.9, verifique a licença do mesmo.
